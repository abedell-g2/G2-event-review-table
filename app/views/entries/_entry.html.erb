<tr id="entry-<%= entry.id %>" class="entry-row">
  <% if show_email_col %>
    <td class="col-email"><%= entry.email.presence || "â€”" %></td>
  <% end %>
  <td class="col-id">
    <span class="elv-badge id-badge"><%= entry.id_number %></span>
  </td>
  <td class="col-link">
    <a href="<%= entry.link %>" target="_blank" rel="noopener noreferrer" class="link-cell" title="<%= entry.link %>">
      <%= entry.link.truncate(55) %>
    </a>
  </td>
  <td class="col-actions">
    <div class="action-btns">
      <%# QR Code %>
      <button class="icon-btn icon-btn--qr" title="Show QR Code" onclick="showQrModal('<%= entry.link %>')">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="17" height="17">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 013.75 9.375v-4.5zM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 01-1.125-1.125v-4.5zM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0113.5 9.375v-4.5z"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 6.75h.75v.75h-.75v-.75zM6.75 16.5h.75v.75h-.75v-.75zM16.5 6.75h.75v.75h-.75v-.75zM13.5 13.5h.75v.75h-.75v-.75zM13.5 19.5h.75v.75h-.75v-.75zM19.5 13.5h.75v.75h-.75v-.75zM19.5 19.5h.75v.75h-.75v-.75zM16.5 16.5h.75v.75h-.75v-.75z"/>
        </svg>
      </button>

      <%# Edit %>
      <button class="icon-btn icon-btn--edit" title="Edit" onclick="toggleEditRow('<%= entry.id %>')">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="17" height="17">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"/>
        </svg>
      </button>

      <%# Delete %>
      <%= button_to entry_path(entry), method: :delete, data: { turbo_confirm: "Delete entry #{entry.id_number}?" }, class: "icon-btn icon-btn--delete", title: "Delete" do %>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
          <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd"/>
        </svg>
      <% end %>
    </div>

    <%# Inline edit form (hidden by default) %>
    <div id="edit-row-<%= entry.id %>" class="inline-edit-form hidden">
      <%= form_with model: entry, method: :patch, data: { turbo_stream: true } do |f| %>
        <div class="inline-edit-fields">
          <% if show_email_col %>
            <%= f.text_field :email, value: entry.email, placeholder: "email@example.com", class: "elv-form-control inline-input" %>
          <% end %>
          <%= f.text_field :id_number, value: entry.id_number, placeholder: "6-digit ID", maxlength: 6, class: "elv-form-control inline-input inline-input--sm" %>
          <%= f.submit "Save", class: "elv-btn elv-btn--primary elv-btn--sm" %>
          <button type="button" class="elv-btn elv-btn--ghost elv-btn--sm" onclick="toggleEditRow('<%= entry.id %>')">Cancel</button>
        </div>
        <% if entry.errors.any? %>
          <div class="inline-errors"><%= entry.errors.full_messages.join(", ") %></div>
        <% end %>
      <% end %>
    </div>
  </td>
</tr>

<script>
function toggleEditRow(id) {
  const form = document.getElementById('edit-row-' + id);
  if (form) form.classList.toggle('hidden');
}
</script>
